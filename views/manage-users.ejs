<% include layout %>
<h2>Manage Users</h2>
<table class="table">
  <thead>
    <tr>
      <th>Username</th>
      <th>Role</th>
      <th>Created At</th>
      <th>Updated At</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% users.forEach(user => { %>
      <tr>
        <td><%= user.username %></td>
        <td><%= user.role %></td>
        <td><%= user.created_at.toLocaleString() %></td>
        <td>
          <input type="datetime-local" 
                 value="<%= new Date(user.updated_at).toISOString().slice(0, 16) %>" 
                 onchange="updateUserTimestamp('<%= user.username %>', this.value)" />
        </td>
        <td>
          <a href="/edit-user/<%= user.username %>" class="btn btn-sm btn-warning">Edit</a>
          <form action="/delete-user/<%= user.username %>" method="POST" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
          </form>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>
<a href="/add-user" class="btn btn-success">Add User</a>

<script>
  function updateUserTimestamp(username, timestamp) {
    fetch(`/update-user-timestamp/${username}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ updated_at: timestamp }),
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Timestamp updated successfully');
        } else {
          alert('Failed to update timestamp');
        }
      })
      .catch(error => console.error('Error:', error));
  }
</script>